@startuml

'=====Style=====
!function $autogenerated($a)
!return "<color:RoyalBlue>" + $a + " <<autogenerated PK>></color>"
!endfunction

!function $unique($a)
!return "<color:Crimson>" + $a + " <<unique>></color>"
!endfunction

!function $setBold($a)
!return "<b>" + $a + " </b>"
!endfunction

skinparam BackgroundColor SeaShell
skinparam LegendBackgroundColor MistyRose
skinparam LegendBorderColor PaleVioletRed
skinparam LegendFontColor PaleVioletRed

skinparam Class {
    HeaderBackgroundColor PaleGreen
}

skinparam TitleFontColor Sienna

legend right
$setBold("Условные обозначения:")
* - обязательное поле
PK - первичный ключ
FK - внешний ключ
end legend
'==========

header SmartHome
title ER-диаграмма

entity "$setBold("Accounts")" as Accounts{
    * $autogenerated("id : uuid")
    ..
    * $unique("username : string")
    * password : string
    * name : string
    * surname : string
    * $unique("email : string")
    created_at : timestamp
    updated_at: timestamp
}

entity "$setBold("Houses")" as Houses {
    * $autogenerated("id : uuid")
    ..
    * account_id : uuid <<Accounts.id FK>>
    * address : string
    * name : string
    created_at : timestamp
    updated_at : timestamp
}

entity "$setBold("Rooms")" as Rooms {
    * $autogenerated("id : uuid")
    ..
    * house_id : uuid <<Houses.id FK>>
    * name : string
    created_at : timestamp
    updated_at : timestamp
}

entity "$setBold("Devices")" as Devices {
    * $autogenerated("id : uuid")
    ..
    * room_id : uuid <<Rooms.id FK>>
    * name : string
    * type_id : uuid <<DeviceTypes.id FK>>
    * status : uuid <<DeviceStatus.id FK>>
    created_at : timestamp
    updated_at : timestamp
}

entity "$setBold("Telemetry")" as Telemetry {
    * $autogenerated("id : uuid")
    ..
    * device_id : uuid <<Devices.id FK>>
    * type_id : uuid <<TelemetryTypes.id FK>>
    * name : string
    * value : double
    created_at : timestamp
    updated_at : timestamp
}

entity "$setBold("DeviceTypes")" as DeviceTypes {
    * $autogenerated("id : uuid")
    ..
    * $unique("name : string")
}

entity "$setBold("TelemetryTypes")" as TelemetryTypes {
    * $autogenerated("id : uuid")
    ..
    * $unique("name : string")
}

entity "$setBold("DeviceStatus")" as DeviceStatus {
    * $autogenerated("id : uuid")
    ..
    * $unique("name : string")
}

entity "$setBold("Scenarios")" as Scenarios {
    * $autogenerated("id : uuid")
    ..
    * name : string
    * house_id : uuid <<Houses.id FK>>
    * scenario : text
    * isEnable : bool
    created_at : timestamp
    updated_at : timestamp
}

entity "$setBold("HeatingDevices")" as HeatingDevices {
    * $autogenerated("id : uuid")
    ..
    * device_id : uuid <<Devices.id FK>>
    * $unique("serialNumber : string")
    * secretKey : string
    * url : string
    * targetTemp : double
    * isEnable: bool
    created_at : timestamp
    updated_at : timestamp
}

entity "$setBold("TemperatureSensorDevice")" as TemperatureSensorDevice {
    * $autogenerated("id : uuid")
    ..
    * device_id : uuid <<Devices.id FK>>
    * $unique("serialNumber : string")
    * secretKey : string
    * url : string
    created_at : timestamp
    updated_at : timestamp
}

Accounts::id "1" ||-o{ "0..*" Houses::account_id : ""

Houses::id "1" ||-up-|{ "1..*" Rooms::house_id : ""
Houses::id "1" ||-down-o{ "0..*" Scenarios::house_id : ""

Rooms::id "1" ||-o{ "0..*" Devices::room_id : ""

Devices::id "1" ||-down-o{ "0..*" Telemetry::device_id : ""
Devices::type_id "0..*" }o-up-|| "1" DeviceTypes::id : ""
Devices::status "0..*" }-up-|| "1" DeviceStatus::id : ""
Devices::id "1" ||-|| "1" HeatingDevices::device_id : ""
Devices::id "1" ||-up-|| "1" TemperatureSensorDevice::device_id : ""

Telemetry::type_id "0..*" }o-down-|| "1" TelemetryTypes::id : ""

@enduml