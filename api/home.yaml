asyncapi: 3.0.0
info:
  title: Home
  version: 1.0.0
  description: Микросервис управления домом

servers:
  Dev:
    host: localhost:8092
    description: Development
    protocol: kafka

channels:
  addHeatingSystem:
    description: Подключение новых устройств отопления
    address: add_heating_system
    messages:
      newHeatingSystem:
        $ref: '#/components/messages/newHeatingSystem'

  delHeatingSystem:
    description: Удаление устройств отопления
    address: del_heating_system
    messages:
      idHeatingSystem:
        $ref: "#/components/messages/deviceId"

  statusHeatingSystem:
    description: Текущий статус работы системы отопления и телеметрия
    address: status_heating_system
    messages:
      statusHeatingSystem:
        $ref: "#/components/messages/statusHeatingSystem"

  turnOnOffHeatingSystem:
    description: Включение и отключение отопления
    address: turn_on_off_heating_system
    messages:
      controlHeatingSystem:
        $ref: "#/components/messages/controlHeatingSystem"

  setupTemperature:
    description: Установка целевой температуры дома
    address: target_temp_heating_system
    messages:
      setupHeatingSystem:
        $ref: "#/components/messages/setupHeatingSystem"

  addTemperatureSensor:
    description: Подключение новых датчиков температуры
    address: add_temperature_sensor
    messages:
      newHeatingSystem:
        $ref: '#/components/messages/newTemperatureSensor'

  delTemperatureSensor:
    description: Удаление датчиков температуры
    address: del_temperature_sensor
    messages:
      idHeatingSystem:
        $ref: "#/components/messages/deviceId"

  statusTemperatureSensor:
    description: Текущий статус датчика температуры
    address: status_temperature_sensor
    messages:
      statusHeatingSystem:
        $ref: "#/components/messages/statusTemperatureSensor"


operations:
  createHeatingSystem:
    action: send
    channel:
      $ref: '#/channels/addHeatingSystem'

  deletingHeatingSystem:
    action: send
    channel:
      $ref: '#/channels/delHeatingSystem'

  statusHeatingSystem:
    title: "Статус устройства"
    action: receive
    channel:
      $ref: '#/channels/statusHeatingSystem'

  controlHeatingSystem:
    action: send
    channel:
      $ref: '#/channels/turnOnOffHeatingSystem'

  setupHeatingSystem:
    action: send
    channel:
      $ref: '#/channels/setupTemperature'

  createTemperatureSensor:
    action: send
    channel:
      $ref: '#/channels/addTemperatureSensor'

  deletingTemperatureSensor:
    action: send
    channel:
      $ref: '#/channels/delTemperatureSensor'

  statusTemperatureSensor:
    title: "Статус датчика температуры"
    action: receive
    channel:
      $ref: '#/channels/statusTemperatureSensor'

components:
  messages:
    newHeatingSystem:
      payload:
        type: object
        properties:
          deviceId:
            type: string
            format: uuid
          serialNumber:
            type: string
          secretKey:
            type: string
          addressHeatingSystem:
            type: string

    deviceId:
      payload:
        type: object
        properties:
          deviceId:
            type: string
            format: uuid

    statusHeatingSystem:
      payload:
        type: object
        properties:
          deviceId:
            type: string
            format: uuid
          currentTemp:
            type: number
            format: float
          targetTemp:
            type: number
            format: float
          status:
            type: string
            enum:
              - created
              - enable
              - disable
              - error
              - deleted

    controlHeatingSystem:
      payload:
        type: object
        properties:
          deviceId:
            type: string
            format: uuid
          isEnable:
            type: boolean

    setupHeatingSystem:
      payload:
        type: object
        properties:
          deviceId:
            type: string
            format: uuid
          targetTemp:
            type: number
            format: float

    newTemperatureSensor:
      payload:
        type: object
        properties:
          deviceId:
            type: string
            format: uuid
          serialNumber:
            type: string
          secretKey:
            type: string
          addressHeatingSystem:
            type: string

    statusTemperatureSensor:
      payload:
        type: object
        properties:
          deviceId:
            type: string
            format: uuid
          currentTemp:
            type: number
            format: float
          status:
            type: string
            enum:
              - created
              - work
              - error
              - deleted